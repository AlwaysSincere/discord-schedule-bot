# Daily schedule automation
# Discord Schedule Bot - ì—°ê²° í…ŒìŠ¤íŠ¸
name: Discord Connection Test

# ì–¸ì œ ì‹¤í–‰í• ì§€ ì„¤ì •
on:
  # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)
  workflow_dispatch:
  
  # ë‚˜ì¤‘ì— ìë™ ì‹¤í–‰ì„ ìœ„í•œ ìŠ¤ì¼€ì¤„ (í˜„ì¬ëŠ” ì£¼ì„ ì²˜ë¦¬)
  # schedule:
  #   - cron: '0 9 * * *'  # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ì‹œê°„ ì˜¤í›„ 6ì‹œ)

# ì‹¤í–‰í•  ì‘ì—…ë“¤
jobs:
  test-discord-connection:
    runs-on: ubuntu-latest  # Ubuntu ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì—ì„œ ì‹¤í–‰
    
    steps:
    # 1ë‹¨ê³„: ì½”ë“œ ë‹¤ìš´ë¡œë“œ
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    # 2ë‹¨ê³„: Python ì„¤ì¹˜
    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    # 3ë‹¨ê³„: í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
    - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # 4ë‹¨ê³„: Discord ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    - name: ğŸ¤– Discord ì—°ê²° í…ŒìŠ¤íŠ¸
      env:
        DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        CALENDAR_ID: ${{ secrets.CALENDAR_ID }}
      run: |
        echo "Discord ë´‡ ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
        python src/discord_collector.py
